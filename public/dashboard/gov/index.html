<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../componets.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <title>Government Dashboard</title>
</head>
<body>
    <div id="top">
        <h1>Government Dashboard</h1>
    </div>
    <div id="bottom">
        <!-- SECTION 1: NEW REPORTS -->
        <div id="new-reports" class="reports-section">
            <div class="section-header">
                <h2>New Reports</h2>
                <i class="bi bi-funnel"></i>
            </div>
            <div class="reports-cont">
                <div class="report-card card-fire" id="12345">
                    <div class="report-container">
                        <div class="header">
                            <h2>Report Summary</h2>
                            <div class="r-date">2024-06-15</div>
                            <div class="r-id">#12345</div>
                            <div class="tag r-fire tag-type"><i class="bi bi-fire"></i>Fire</div>
                            <div class="tag r-s r-s-o"></div>
                        </div>
                        <div class="discription">
                            <p>This is a summary of the report content. It gives a brief overview of the issue.</p>
                        </div>
                        <div class="image">
                        </div>
                        <div class="action">
                            <!-- The "New" button calls markDispatched -->
                            <button class="btn btn-warning" onclick="markDispatched(this)">Mark Dispatched</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 2: PENDING REPORTS -->
        <div id="pending-r" class="reports-section">
            <div class="section-header">
                <h2>Pending Reports</h2>
                <i class="bi bi-funnel"></i>
            </div>
            <div class="reports-cont">
                <div class="report-card card-fire" id="67890">
                    <div class="report-container">
                        <div class="header">
                            <h2>Report Summary</h2>
                            <div class="r-date">2024-06-15</div>
                            <div class="r-id">#67890</div>
                            <div class="tag r-fire tag-type"><i class="bi bi-fire"></i>Fire</div>
                            <div class="tag r-s r-s-o"></div>
                        </div>
                        <div class="discription">
                            <p>This is a summary of the report content. It gives a brief overview of the issue.</p>
                        </div>
                        <div class="image">
                        </div>
                        <div class="action">
                           <!-- HUMZIE'S FIX 2: The "Pending" button calls markCompleted -->
                           <button class="btn btn-warning" onclick="markCompleted(this)">Mark Completed</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 3: RESOLVED REPORTS (This was causing your error!) -->
        <div id="resolved-r" class="reports-section">
            <div class="section-header">
                <h2>Resolved</h2>
                <i class="bi bi-funnel"></i>
            </div>
            <div class="reports-cont">
                <div class="report-card card-fire" id="12345">
                    <div class="report-container">
                        <div class="header">
                            <h2>Report Summary</h2>
                            <div class="r-date">2024-06-15</div>
                            <div class="r-id">#12345</div>
                            <div class="tag r-fire tag-type"><i class="bi bi-fire"></i>Fire</div>
                            <div class="tag r-s r-s-o"></div>
                        </div>
                        <div class="discription">
                            <p>This is a summary of the report content. It gives a brief overview of the issue.</p>
                        </div>
                        <div class="image">
                        </div>
                        <div class="action">
                            <!--I removed onclick="update()" because it crashes.
                                 I added 'disabled' so the button is grayed out.
                                 This is correct because a resolved item is already done. -->
                            <button class="btn btn-warning" disabled>Mark Dispatched</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<!-- Connects to your script.js file -->
<script src="script.js"></script>
<script type="module">
    import {AttachToast,toast} from '../../toast.js'
    AttachToast()

    document.addEventListener('DOMContentLoaded',(e)=>{
        fetch('/dashboard',{
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization':`Bearer ${document.cookie.split(';')[0].split('=')[1]}`
            }
        }).then((res)=>{
            console.log(res);
            return res.json()            
        }).then((data)=>{
            console.log(data);
            
            if (data.success) {
                document.getElementById('nameDisplay').innerHTML+=' '+data.feedback.name
                document.getElementById('emailDisplay').innerHTML+=' '+data.feedback.email
                document.getElementById('phoneDisplay').innerHTML+=' '+data.feedback.phone
                document.getElementById('dateDisplay').innerHTML+=' '+data.feedback.name

                toast.success('Success!')
                setTimeout(() => {
                    document.getElementById('preload').style.display='none'
                }, 3100);
            }else {
                toast.error(data.message)
                window.location.href='/login'
            }            
        }).catch((e)=>{
            console.log(e);
            setTimeout(() => {
                window.location.href='/login'
            }, 5000);
        })
    })
</script>
</html>