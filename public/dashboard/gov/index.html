<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../componets.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <title>Government Dashboard</title>
</head>
<body>
    <div id="preload">
        <img src="https://i.pinimg.com/originals/c8/a1/76/c8a1765ffc8243f3a7b176c0ca84c3c1.gif" alt="loading">
    </div>
    <div id="top">
        <img src="..\..\res\logo\logo.png" alt="logo" id="logo">
        <div id="middle">
        <h1>Government Dashboard</h1>
            <div id="userInfo">
                <span id="idDisplay">ID :</span>
                <span id="dateDisplay">Date :</span>
            </div>
        </div>
        <div id="right">
            <button id="logoutBtn" class="btn-circle bi bi-power" title="logout"></button>
            <button id="refreshBtn" class="btn-circle bi bi-arrow-clockwise" onclick="Refresh()" title="refresh"></button>
        </div>
        
    </div>
    <div id="bottom">
        <!-- SECTION 1: NEW REPORTS -->
        <div id="em-req" class="reports-section">
            <div class="section-header">
                <h2>Emergency Requests</h2>
                <i class="bi bi-funnel"></i>
            </div>
            <div class="reports-cont" id="emp-cont">
                <!-- <div class="report-card card-fire" id="12345">
                    <div class="report-container">
                        <div class="header">
                            <h2>Report Summary</h2>
                            <div class="r-date">2024-06-15</div>
                            <div class="r-id">#12345</div>
                            <div class="tag r-fire tag-type"><i class="bi bi-fire"></i>Fire</div>
                            <div class="tag r-s r-s-o"></div>
                        </div>
                        <div class="discription">
                            <p>This is a summary of the report content. It gives a brief overview of the issue.</p>
                        </div>
                        <div class="image">
                        </div>
                        <div class="action">
                            <button class="btn btn-warning" onclick="markDispatched(this)">Mark Dispatched</button>
                        </div>
                    </div>
                </div> -->
            </div>
        </div>

        <!-- SECTION 2: PENDING REPORTS -->
        <div id="pending-r" class="reports-section">
            <div class="section-header">
                <h2>Pending Reports</h2>    
                <i class="bi bi-funnel"></i>
            </div>
            <div class="reports-cont" id="pend-cont">
                <!-- <div class="report-card card-fire" id="67890">
                    <div class="report-container">
                        <div class="header">
                            <h2>Report Summary</h2>
                            <div class="r-date">2024-06-15</div>
                            <div class="r-id">#67890</div>
                            <div class="tag r-fire tag-type"><i class="bi bi-fire"></i>Fire</div>
                            <div class="tag r-s r-s-o"></div>
                        </div>
                        <div class="discription">
                            <p>This is a summary of the report content. It gives a brief overview of the issue.</p>
                        </div>
                        <div class="image">
                        </div>
                        <div class="action">
                           <button class="btn btn-warning" onclick="markCompleted(this)">Mark Completed</button>
                        </div>
                    </div>
                </div> -->
            </div>
        </div>

        <!-- SECTION 3: COMPLAINTS REPORTS -->
        <div id="resolved-r" class="reports-section">
            <div class="section-header">
                <h2>Complaints</h2>
                <i class="bi bi-funnel"></i>
            </div>
            <div class="reports-cont" id="cmp-cont">
                <!-- <div class="report-card card-fire" id="12345">
                    <div class="report-container">
                        <div class="header">
                            <h2>Report Summary</h2>
                            <div class="r-date">2024-06-15</div>
                            <div class="r-id">#12345</div>
                            <div class="tag r-fire tag-type"><i class="bi bi-fire"></i>Fire</div>
                            <div class="tag r-s r-s-o"></div>
                        </div>
                        <div class="discription">
                            <p>This is a summary of the report content. It gives a brief overview of the issue.</p>
                        </div>
                        <div class="image">
                        </div>
                        <div class="action">
                            <button class="btn btn-warning" onclick="markDispatched(this)">Mark Dispatched</button>
                        </div>
                    </div>
                </div> -->
            </div>
        </div>
    </div>
</body>
<!-- Connects to your script.js file -->
<script src="../../toast.js" type="module"></script>
<script src="script.js" type="module"></script>
<script type="module">
    import {AttachToast,toast} from '../../toast.js'
    AttachToast()

    document.addEventListener('DOMContentLoaded',(e)=>{
        fetch('/dashboard',{
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization':`Bearer ${document.cookie.split(';')[0].split('=')[1]}`
            }
        }).then((res)=>{
            console.log(res);
            return res.json()         
        }).then((data)=>{
            console.log(data);
            var date = new Date().toDateString().split(' ')
            
            if (data.success) {
                document.getElementById('idDisplay').innerHTML+=' '+data.feedback.empID
                document.getElementById('dateDisplay').innerHTML+=' '+date[2]+' - '+date[1]+' - '+date[3]

                toast.success('Success!')
                setTimeout(() => {
                    document.getElementById('preload').style.display='none'
                }, 3100);
            }else {
                toast.error(data.message)
                window.location.href='/login'
            }            
        }).catch((e)=>{
            console.log(e);
            setTimeout(() => {
                window.location.href='/login'
            }, 5000);
        })
    })
</script>
</html>